<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Phpactor</title>

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <link rel="stylesheet" href="https://phpactor.github.io/phpactor/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://phpactor.github.io/phpactor/css/highlight.tomorrow-night.css">
        <link rel="stylesheet" href="https://phpactor.github.io/phpactor/css/main.css">
    </head>
    <body>

        <main class="container-fluid">
            <div class="row">

                    <nav id="sidebar" class="col-sm-3 col-lg-2" role="navigation">
                        <div class="logo">
<center>
							<a href="https://phpactor.github.io/phpactor"><img src="https://phpactor.github.io/phpactor/images/logo-small.png" /></a>
							<br/>
							<b>Phpactor</b><br/> <i>Intelligent completion and refactoring tool for PHP</i>
</center>
						</div>

                                                    <p class="text-muted">
                                Home
                            </p>

                            <ul class="nav nav-pills nav-stacked">
                                                                    <li class="">
                                        <a href="https://phpactor.github.io/phpactor/index.html">
                                            About
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                Usage
                            </p>

                            <ul class="nav nav-pills nav-stacked">
                                                                    <li class="">
                                        <a href="https://phpactor.github.io/phpactor/standalone.html">
                                            Standalone
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://phpactor.github.io/phpactor/vim-plugin.html">
                                            VIM plugin
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://phpactor.github.io/phpactor/configuration.html">
                                            Configuration
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                Reference
                            </p>

                            <ul class="nav nav-pills nav-stacked">
                                                                    <li class="">
                                        <a href="https://phpactor.github.io/phpactor/completion.html">
                                            Completion
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://phpactor.github.io/phpactor/navigation.html">
                                            Navigation
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://phpactor.github.io/phpactor/refactorings.html">
                                            Refactorings
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                Other topics
                            </p>

                            <ul class="nav nav-pills nav-stacked">
                                                                    <li class="">
                                        <a href="https://phpactor.github.io/phpactor/integrations.html">
                                            Integrations
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://phpactor.github.io/phpactor/history.html">
                                            History
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://phpactor.github.io/phpactor/developing.html">
                                            Debugging Phpactor
                                        </a>
                                    </li>
                                                                    <li class="active">
                                        <a href="https://phpactor.github.io/phpactor/rpc.html">
                                            RPC Protocol
                                        </a>
                                    </li>
                                                            </ul>
                        
                    </nav>

                <section class="col-sm-offset-3 col-lg-offset-2 col-sm-9 col-lg-10">
                    <h1 id="rpc-protocol">RPC Protocol</h1>
<div class="alert alert-danger">
This document should largely be correct but is a work-in-progress
</div>
<p>Phpactor communicates with the editor over its own RPC protocol which
effectively allows the editor to intruct Phpactor to do things, and in turn
Phpactor can also instruct the editor to do things.</p>
<p><img src="https://user-images.githubusercontent.com/530801/30521464-39743352-9bc0-11e7-92ac-06b3228adf67.png" alt="rpc" /></p>
<p>Requests can be sent via. <code>stdin</code> to the Phpactor <code>rpc</code> command </p>
<pre><code class="language-bash">$ echo '{"action": "echo", "parameters": { "message": "Hello" }}' | ./bin/phpactor rpc</code></pre>
<p>Above we use the somewhat pointless <code>echo</code> action, which simply returns a
response asking the editor to echo a message. The result is sent over
<code>stdout</code>:</p>
<pre><code class="language-javascript">{"action":"echo","parameters":{"message":"Hello"}}</code></pre>
<p>Responses contain an action which will be executed in
the editor.</p>
<p>Some responses will include callbacks to Phpactor. This allows Phpactor to ask
for more information as required.</p>
<h2 id="work-in-progress">Work-in-progress</h2>
<p>This Protocol is a work-in-progress.</p>
<p>TODO:</p>
<ul>
<li>Parameters should not refer to file paths in class contexts: Although
classes map 1-1 to files now, this may not always be the case and Phpactor
can figure out a file-path from a class-name and vice-versa (so <code>class</code>
instead of <code>class_path</code>).</li>
</ul>
<h2 id="editor-actions">Editor Actions</h2>
<h3><code>return</code></h3>
<p>Return a value. This action should return the value immediately to the caller
without further dispatches.</p>
<ul>
<li><strong>Name</strong>: <code>return</code></li>
<li><strong>Parameters</strong>:
<ul>
<li><strong>Value</strong>: Value to return.</li>
</ul></li>
</ul>
<h3><code>return_choice</code></h3>
<p>The editor should render a dialog asking the user to select a choice:</p>
<pre><code>1) Do this
2) Do that</code></pre>
<p>It should then <code>return</code> the chosen value.</p>
<ul>
<li><strong>Name</strong>: <code>return_choice</code></li>
<li><strong>Parameters</strong>:
<ul>
<li><code>choices</code>: Key to value list of choices, the key is the label for the
choice, the value is the value to return.</li>
</ul></li>
</ul>
<h3><code>echo</code></h3>
<p>The editor should echo (or otherwise visibly display) a message.</p>
<ul>
<li><strong>Name</strong>: <code>echo</code></li>
<li><strong>Parameters</strong>:
<ul>
<li><code>message</code>: Message to display.</li>
</ul></li>
</ul>
<h3><code>error</code></h3>
<p>The editor should show an error.</p>
<ul>
<li><strong>Name</strong>: <code>error</code></li>
<li><strong>Parameters</strong>:
<ul>
<li><code>message</code>: Error message to display.</li>
</ul></li>
</ul>
<h3><code>collection</code></h3>
<p>Collection of actions to be executed sequentially until there are no more or
until a <code>return</code> is encountered.</p>
<ul>
<li><strong>Name</strong>: <code>collection</code></li>
<li><strong>Parameters</strong>:
<ul>
<li><code>actions</code>: Array of actions to dispatch.</li>
</ul></li>
</ul>
<h3><code>open_file</code></h3>
<p>Open a file in the editor.</p>
<ul>
<li><strong>Name</strong>: <code>open_file</code></li>
<li><strong>Parameters</strong>:
<ul>
<li><code>path</code>: Path to file which should be opened.</li>
<li><code>offset</code>: Goto this offset after opening the file.</li>
</ul></li>
</ul>
<h3><code>close_file</code></h3>
<p>Close a file.</p>
<ul>
<li><strong>Name</strong>: <code>close_file</code></li>
<li><strong>Parameters</strong>:
<ul>
<li><code>path</code>: Path to file which should be closed.</li>
</ul></li>
</ul>
<h3><code>file_references</code></h3>
<p>List of files and references. The editor should populate a navigable list of
the files and the references (in VIM this is a quick-fix list).</p>
<ul>
<li><strong>Name</strong>: <code>file_references</code></li>
<li><strong>Parameters</strong>:
<ul>
<li><code>references</code>: Array containing file paths nested with references:</li>
</ul></li>
</ul>
<p>Example of <code>references</code> parameter:</p>
<pre><code class="language-javascript">{
    "file_references": [
        {
            "file": "/path/to/File.php",
            "references": [
                {
                    "line_no": 1234,
                    "col": 12
                },
                {
                    "line_no": 1234,
                    "col": 12
                }
            ]
        }
    ]
}</code></pre>
<h3><code>input_callback</code></h3>
<p>This action will provide a callback to Phpactor and inputs which the end-user
will need to complete to populate the parameters of the callback.</p>
<ul>
<li><strong>Name</strong>: <code>input_callback</code></li>
<li><strong>Parameters</strong>:
<ul>
<li><code>callback</code>:
<ul>
<li><code>action</code>: Callback command name for Phpactor.</li>
<li><code>parameters</code>: Array of parameters to pass.</li>
</ul></li>
<li><code>inputs</code>: Array of inputs</li>
</ul></li>
</ul>
<p>Example:</p>
<pre><code class="language-javascript">{
    "callback": {
        "action": "hello",
        "parameters": {
            "greeting": "Hello",
            "first_name": "value1"
        }
    }
    "inputs": [
        {
            "name": "first_name",
            "type": "text",
            "parameters": {
                "default": "&lt;enter your first name&gt;",
            }
        }
    ]
}</code></pre>
<p>See the VIM plugin for the supported inputs.</p>
<h3><code>information</code></h3>
<p>Show information in a persistent and unobtrusive way (in VIM as a preview
window).</p>
<ul>
<li><strong>Name</strong>: <code>information</code></li>
<li><strong>Parameters</strong>:
<ul>
<li><code>information</code>: Information to show (text)</li>
</ul></li>
</ul>
<h3><code>replace_file_source</code></h3>
<p>Replace the source code in the current file.</p>
<ul>
<li><strong>Name</strong>: <code>replace_file_source</code></li>
<li><strong>Parameters</strong>:
<ul>
<li><code>source</code>: Source code.</li>
</ul></li>
</ul>
<h2 id="phpactor-commands">Phpactor Commands</h2>
<p>In the following references all parameters are assumed to be required unless
otherwise stated. <em>optional</em> parameters are optional, <em>eventually required</em> means the parameter is optional, but if not given Phpactor will ask for it (via. a callback).</p>
<p>Note that after implementing a dispatcher for standard editor actions above it
is not necessary to know the result of these commands, they will be handled by
your editor.</p>
<h3><code>complete</code></h3>
<p>The complete RPC command returns a list of completions:</p>
<pre><code class="language-bash">$ echo '{"actions": [ {"action": "complete", "parameters": { "source": "&lt;?php $foo = new Exception(); $foo-&gt;", "offset": 37} }] }' | ./bin/phpactor rpc</code></pre>
<p>Example response:</p>
<pre><code>{                                                    
    "actions": [                          
        {                          
            "action": "return",             
            "parameters": {            
                "value": [                              
                    {                      
                        "info": "pri __clone(): void",
                        "name": "__clone",  
                        "type": "f"    
                    },                                         
                    {                         
                        "info": "pub getMessage(): string",
                        "name": "getMessage",
                        "type": "f"    
                    },                                           
                    {                              
                        "info": "pub getCode()",
                        "name": "getCode",
                        "type": "f"
                    },                                     
                ]
            }
        }
    ]
}</code></pre>
<h3><code>class_search</code></h3>
<pre><code class="language-bash">$ echo '{"actions": [ {"action": "class_search", "parameters": { "short_name": "InputInterface" } }] }' | ./bin/phpactor rpc</code></pre>
<h3><code>goto_definition</code></h3>
<p>Open file and goto offset of symbol at the given offset in the given source
code:</p>
<ul>
<li><strong>Name</strong>: <code>goto_definition</code></li>
<li><strong>Parameters</strong>:
<ul>
<li><code>source</code>: Source code as a string</li>
<li><code>offset</code>: Offset of symbol (int)</li>
</ul></li>
</ul>
<pre><code class="language-bash">$ echo '{"actions": [ {"action": "goto_definition", "parameters": { "source": "&lt;?php $foo = new Exception(); $foo-&gt;getMessage()", "offset": 37} }] }' | ./bin/phpactor rpc</code></pre>
<p>Will return an action to open the file containing the definition and goto the
offset.</p>
<h3><code>copy_class</code></h3>
<p>Copy a class to a new location and update its name accordingly:</p>
<ul>
<li><strong>Name</strong>: <code>copy_class</code></li>
<li><strong>Parameters</strong>:
<ul>
<li><code>source_path</code>: File containing class to copy..</li>
<li><code>dest_path</code>: (eventually required) Destination path </li>
</ul></li>
</ul>
<pre><code class="language-bash">$ echo '{"actions": [ {"action": "copy_class", "parameters": { "source_path": "/path/to/class.php" } } ] }| ./bin/phpactor rpc</code></pre>
<p>Will return an action to open the new file.</p>
<h3><code>move_class</code></h3>
<p>Move a class and update all references to it in the project.</p>
<ul>
<li><strong>Name</strong>: <code>move_class</code></li>
<li><strong>Parameters</strong>:
<ul>
<li><code>source_path</code>: File containing class to move.</li>
<li><code>dest_path</code>: (eventually required) File to move class to.</li>
</ul></li>
</ul>
<p>Will eventually return an action to open the new file, and a command to forget about the
old one.</p>
<h3><code>offset_info</code></h3>
<p>Return debug information about the symbol and the state of the frame at the
given offset.</p>
<ul>
<li><strong>Name</strong>: <code>offset_info</code></li>
<li><strong>Parameters</strong>:
<ul>
<li><code>source</code>: Source code as a string</li>
<li><code>offset</code>: Offset of symbol (int)</li>
</ul></li>
</ul>
<p>Returns an (information) action to show a pretty-printed JSON string
containing the debug information.</p>
<h3><code>transform</code></h3>
<p>Perform a transformation on the class in the given file.</p>
<ul>
<li><strong>Name</strong>: <code>transform</code></li>
<li><strong>Parameters</strong>:
<ul>
<li><code>source</code>: Source</li>
<li><code>path</code>: Path for file containing class to transform (required only in order
to reload the file in the editor later).</li>
<li><code>transform</code>: (eventually required) Name of transformation to make.</li>
</ul></li>
</ul>
<p>If no transformation Phpactor will offer a choice of available
transformations, then make the transformation and ask the editor to reload the
file.</p>
<h3><code>class_new</code></h3>
<p>Generate a new class.</p>
<ul>
<li><strong>Name</strong>: <code>class_new</code></li>
<li><strong>Parameters</strong>:
<ul>
<li><code>current_path</code>: Path to current file (used as default for new path)</li>
<li><code>new_path</code>: (eventually required) Path to new class.</li>
<li><code>variant</code>: (eventually required) Variant to create.</li>
<li><code>overwrite</code>: (conditionally eventually required) If file already exists
then this should be true in order that it is overwritten.</li>
</ul></li>
</ul>
<p>Will return an action to open the new file.</p>
<h3><code>class_inflect</code></h3>
<p>Generate a new class based on the current (given) class.</p>
<ul>
<li><strong>Name</strong>: <code>class_new</code></li>
<li><strong>Parameters</strong>:
<ul>
<li><code>current_path</code>: Path to current file (used as default for new path)</li>
<li><code>new_path</code>: (eventually required) Path to new class.</li>
<li><code>variant</code>: (eventually required) Variant to create.</li>
<li><code>overwrite</code>: (conditionally eventually required) If file already exists
then this should be true in order that it is overwritten.</li>
</ul></li>
</ul>
<p>Will return an action to open the new file.</p>
<h3><code>references</code></h3>
<p>Find references to the symbol under the cursor.</p>
<ul>
<li><strong>Name</strong>: <code>references</code></li>
<li><strong>Parameters</strong>:
<ul>
<li><code>source</code>: Source code as a string</li>
<li><code>offset</code>: Offset of symbol (int)</li>
</ul></li>
</ul>
<p>Will return a file-list action, containing a list of all the files in which
references can be found (and the position of all the references).</p>
<h3><code>extract_constant</code></h3>
<p>Extract a constant from the value at the given offset and replace all
identical values with a reference to the constant.</p>
<ul>
<li><strong>Name</strong>: <code>extract_constant</code></li>
<li><strong>Parameters</strong>:
<ul>
<li><code>source</code>: Source code as a string</li>
<li><code>offset</code>: Offset of symbol (int)</li>
<li><code>constant_name</code>: Name for constant.</li>
<li><code>constant_suggestion_name</code>: (optional) Use this as a suggestion when
interactive.</li>
</ul></li>
</ul>
<p>Will return an action to replace the file with the updated code.</p>
<h3><code>generate_method</code></h3>
<p>Generate (or update) a method from the <strong>method call</strong> at the given offset in the
given source.</p>
<ul>
<li><strong>Name</strong>: <code>extract_constant</code></li>
<li><strong>Parameters</strong>:
<ul>
<li><code>source</code>: Source code as a string</li>
<li><code>path</code>: Path to source</li>
<li><code>offset</code>: Offset of symbol (int)</li>
</ul></li>
</ul>
<p>Will return an action to replace the file with the updated code.</p>
<h3><code>generate_accessor</code></h3>
<p>Generate (or update) an accessor for the property under the cursor.</p>
<ul>
<li><strong>Name</strong>: <code>extract_constant</code></li>
<li><strong>Parameters</strong>:
<ul>
<li><code>source</code>: Source code as a string</li>
<li><code>offset</code>: Offset of symbol (int)</li>
</ul></li>
</ul>
<p>Will return an action to replace the file with the updated code.</p>
<h3><code>context_menu</code></h3>
<p>Return a menu for selecting an action to perform on the current symbol</p>
<ul>
<li><strong>Name</strong>: <code>context_menu</code></li>
<li><strong>Parameters</strong>:
<ul>
<li><code>source</code>: Source code as a string</li>
<li><code>offset</code>: Offset of symbol (int)</li>
</ul></li>
</ul>
<h3><code>navigate</code></h3>
<p>Navigate to related source files.</p>
<ul>
<li><strong>Name</strong>: <code>navigate</code></li>
<li><strong>Parameters</strong>:
<ul>
<li><code>source_path</code>: Source code as a string</li>
<li><code>destination</code>: (eventually required) Destination path</li>
<li><code>confirm_create</code>: (conditionally eventually required) Confirm file
creation</li>
</ul></li>
</ul>
                </section>

            </div>

        </main>

        <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
        <script src="//yandex.st/highlightjs/7.5/highlight.min.js"></script>

        <script>
            $(function() {
                $("section>h1").wrap('<div class="page-header" />');
                $("section>h2").each(function (index, value) {
                    $(value).append('&nbsp;<a href="#' + $(value).attr('id') + '"><i class="fa small fa-link"></i></a>');
                });
                // Syntax highlighting
                hljs.initHighlightingOnLoad();
            });
        </script>

		<footer>
<hr />
<center>
			<a href="https://github.com/phpactor/phpactor">
				<i class="fa fa-github"></i>
Fork me on Github!
			</a>
</center>
		</footer>

	</body>
</html>
